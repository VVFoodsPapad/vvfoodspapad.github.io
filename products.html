<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Products | VV Foods Papad</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <header>
        <a href="index.html" class="logo">
            <img src="VVFoodsPapadlogo.png" alt="VV Foods Logo">
            <span>VV Foods</span>
        </a>
        <nav>
            <a href="index.html">Home</a>
            <a href="products.html" class="active">Products</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
        </nav>
    </header>

    <main>
        <section class="hero">
            <h2>Our Crispy Appalams</h2>
            <p>Discover our range of handcrafted appalams.</p>
        </section>

        <section>
            <h2>Our Crispy Appalams</h2>
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-image">
                        <img src="Uraddal.png" alt="Urad Dal Appalam">
                    </div>
                    <h3>Urad Dal Appalam</h3>
                    <p>Our most famoust appalam made from premium urad dal. This is perfectly crispy and complements any meal including rice, dal, and curries.</p>
                </div>
                <div class="product-card">
                    <div class="product-image">
                        <img src="Cumin.png" alt="Cumin Appalam">
                    </div>
                    <h3>Cumin Appalam</h3>
                    <p>An appalam filled with cumin seeds. Perfect for people who need appalams with a taste of spice.</p>
                </div>
                <div class="product-card">
                    <div class="product-image">
                        <img src="Blackpepper.png" alt="Black Pepper Appalam">
                    </div>
                    <h3>Black Pepper Appalam</h3>
                    <p>Ground black pepper for a subtle spice experience.</p>
                </div>
            </div>
        </section>

        <section class="bulk-orders-section">
            <h2>Bulk Orders</h2>
            <p>We offer bulk orders for restaurants, catering businesses, and retailers. Minimum order: 1 kg per variety.</p>
            <p style="margin-top: 1.5rem;">
                <button class="bulk-order-btn" onclick="openOrderModal()">
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    Place Bulk Order
                </button>
            </p>
        </section>
    </main>

    <!-- Order Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeOrderModal()">&times;</span>
            <h2>Place Bulk Order</h2>
            <p class="modal-subtitle">Select your appalams, sizes, and quantities (in kg). Click + to add multiple sizes.</p>

            <form id="orderForm" action="https://formsubmit.co/veera17179@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="New Bulk Order from VV Foods Website">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_next" value="https://vvfoodspapad.com/products.html?success=true">
                <input type="hidden" name="order_summary" id="orderSummaryInput">

                <!-- Urad Dal Plain -->
                <div class="order-item" data-type="plain">
                    <div class="order-item-header">
                        <h3>Urad Dal Plain</h3>
                        <button type="button" class="add-size-btn" onclick="addSizeRow('plain')">+ Add Size</button>
                    </div>
                    <div class="size-rows" id="plain_rows">
                        <div class="order-row">
                            <div class="order-field">
                                <label>Size</label>
                                <select onchange="calculateTotal()">
                                    <option value="">Select Size</option>
                                    <option value="4in">4 IN (â‚¹350/kg, ~210-220 pcs)</option>
                                    <option value="4.5in">4.5 IN (â‚¹350/kg, ~175-180 pcs)</option>
                                    <option value="5in">5 IN (â‚¹350/kg, ~130 pcs)</option>
                                    <option value="6in">6 IN (â‚¹330/kg, ~80-85 pcs)</option>
                                </select>
                            </div>
                            <div class="order-field">
                                <label>Quantity (kg)</label>
                                <input type="number" min="0" step="0.5" value="0" onchange="calculateTotal()">
                            </div>
                            <div class="order-field subtotal-field">
                                <label>Subtotal</label>
                                <span class="subtotal">â‚¹0</span>
                            </div>
                        </div>
                    </div>
                    <div class="item-total">Item Total: <span id="plain_total">â‚¹0</span></div>
                </div>

                <!-- Urad Dal Black Pepper -->
                <div class="order-item" data-type="pepper">
                    <div class="order-item-header">
                        <h3>Urad Dal Black Pepper</h3>
                        <button type="button" class="add-size-btn" onclick="addSizeRow('pepper')">+ Add Size</button>
                    </div>
                    <div class="size-rows" id="pepper_rows">
                        <div class="order-row">
                            <div class="order-field">
                                <label>Size</label>
                                <select onchange="calculateTotal()">
                                    <option value="">Select Size</option>
                                    <option value="4in">4 IN (â‚¹380/kg, ~210-220 pcs)</option>
                                    <option value="4.5in">4.5 IN (â‚¹380/kg, ~175-180 pcs)</option>
                                    <option value="5in">5 IN (â‚¹380/kg, ~130 pcs)</option>
                                    <option value="6in">6 IN (â‚¹350/kg, ~80-85 pcs)</option>
                                </select>
                            </div>
                            <div class="order-field">
                                <label>Quantity (kg)</label>
                                <input type="number" min="0" step="0.5" value="0" onchange="calculateTotal()">
                            </div>
                            <div class="order-field subtotal-field">
                                <label>Subtotal</label>
                                <span class="subtotal">â‚¹0</span>
                            </div>
                        </div>
                    </div>
                    <div class="item-total">Item Total: <span id="pepper_total">â‚¹0</span></div>
                </div>

                <!-- Urad Dal Cumin -->
                <div class="order-item" data-type="cumin">
                    <div class="order-item-header">
                        <h3>Urad Dal Cumin</h3>
                        <button type="button" class="add-size-btn" onclick="addSizeRow('cumin')">+ Add Size</button>
                    </div>
                    <div class="size-rows" id="cumin_rows">
                        <div class="order-row">
                            <div class="order-field">
                                <label>Size</label>
                                <select onchange="calculateTotal()">
                                    <option value="">Select Size</option>
                                    <option value="4in">4 IN (â‚¹375/kg, ~210-220 pcs)</option>
                                    <option value="4.5in">4.5 IN (â‚¹375/kg, ~175-180 pcs)</option>
                                    <option value="5in">5 IN (â‚¹375/kg, ~130 pcs)</option>
                                    <option value="6in">6 IN (â‚¹345/kg, ~80-85 pcs)</option>
                                </select>
                            </div>
                            <div class="order-field">
                                <label>Quantity (kg)</label>
                                <input type="number" min="0" step="0.5" value="0" onchange="calculateTotal()">
                            </div>
                            <div class="order-field subtotal-field">
                                <label>Subtotal</label>
                                <span class="subtotal">â‚¹0</span>
                            </div>
                        </div>
                    </div>
                    <div class="item-total">Item Total: <span id="cumin_total">â‚¹0</span></div>
                </div>

                <div class="order-total">
                    <h3>Grand Total: <span id="grandTotal">â‚¹0</span></h3>
                </div>

                <div class="order-contact">
                    <div class="order-field">
                        <label>Your Name *</label>
                        <input type="text" name="customer_name" id="customerName" required>
                    </div>
                    <div class="order-field">
                        <label>Phone Number *</label>
                        <input type="tel" name="customer_phone" id="customerPhone" required>
                    </div>
                    <div class="order-field full-width">
                        <label>Email *</label>
                        <input type="email" name="customer_email" id="customerEmail" required>
                    </div>
                    <div class="order-field full-width">
                        <label>Delivery Address 1 *</label>
                        <textarea name="customer_address_1" id="customerAddress1" rows="2" placeholder="Primary delivery address" required></textarea>
                    </div>
                    <div class="order-field full-width">
                        <label>Delivery Address 2 (Optional)</label>
                        <textarea name="customer_address_2" id="customerAddress2" rows="2" placeholder="Secondary delivery address (if applicable)"></textarea>
                    </div>
                </div>

                <div class="payment-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <span>Please do not refresh or close the page during payment.</span>
                </div>

                <button type="button" class="checkout-btn" id="checkoutBtn" onclick="initiatePayment()" disabled>Pay with Razorpay (â‚¹0)</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 VV Foods Papad. All rights reserved.</p>
    </footer>

    <script>
        const RAZORPAY_KEY = 'rzp_live_S0C6hYSTDsgzJr';
        let currentTotal = 0;
        let currentOrderSummary = '';

        const prices = {
            plain: { '4in': 350, '4.5in': 350, '5in': 350, '6in': 330 },
            pepper: { '4in': 380, '4.5in': 380, '5in': 380, '6in': 350 },
            cumin: { '4in': 375, '4.5in': 375, '5in': 375, '6in': 345 }
        };

        const sizeOptions = {
            plain: `<option value="">Select Size</option>
                    <option value="4in">4 IN (â‚¹350/kg, ~210-220 pcs)</option>
                    <option value="4.5in">4.5 IN (â‚¹350/kg, ~175-180 pcs)</option>
                    <option value="5in">5 IN (â‚¹350/kg, ~130 pcs)</option>
                    <option value="6in">6 IN (â‚¹330/kg, ~80-85 pcs)</option>`,
            pepper: `<option value="">Select Size</option>
                    <option value="4in">4 IN (â‚¹380/kg, ~210-220 pcs)</option>
                    <option value="4.5in">4.5 IN (â‚¹380/kg, ~175-180 pcs)</option>
                    <option value="5in">5 IN (â‚¹380/kg, ~130 pcs)</option>
                    <option value="6in">6 IN (â‚¹350/kg, ~80-85 pcs)</option>`,
            cumin: `<option value="">Select Size</option>
                    <option value="4in">4 IN (â‚¹375/kg, ~210-220 pcs)</option>
                    <option value="4.5in">4.5 IN (â‚¹375/kg, ~175-180 pcs)</option>
                    <option value="5in">5 IN (â‚¹375/kg, ~130 pcs)</option>
                    <option value="6in">6 IN (â‚¹345/kg, ~80-85 pcs)</option>`
        };

        function addSizeRow(type) {
            const container = document.getElementById(`${type}_rows`);
            const newRow = document.createElement('div');
            newRow.className = 'order-row';
            newRow.innerHTML = `
                <div class="order-field">
                    <label>Size</label>
                    <select onchange="calculateTotal()">${sizeOptions[type]}</select>
                </div>
                <div class="order-field">
                    <label>Quantity (kg)</label>
                    <input type="number" min="0" step="0.5" value="0" onchange="calculateTotal()">
                </div>
                <div class="order-field subtotal-field">
                    <label>Subtotal</label>
                    <span class="subtotal">â‚¹0</span>
                </div>
                <button type="button" class="remove-row-btn" onclick="removeRow(this)">Ã—</button>
            `;
            container.appendChild(newRow);
        }

        function removeRow(btn) {
            btn.parentElement.remove();
            calculateTotal();
        }

        function calculateTotal() {
            let grandTotal = 0;
            let orderSummary = [];

            ['plain', 'pepper', 'cumin'].forEach(type => {
                const container = document.getElementById(`${type}_rows`);
                const rows = container.querySelectorAll('.order-row');
                let itemTotal = 0;
                const typeName = type === 'plain' ? 'Urad Dal Plain' : type === 'pepper' ? 'Urad Dal Black Pepper' : 'Urad Dal Cumin';

                rows.forEach(row => {
                    const size = row.querySelector('select').value;
                    const qty = parseFloat(row.querySelector('input').value) || 0;
                    const subtotalSpan = row.querySelector('.subtotal');
                    let subtotal = 0;

                    if (size && qty > 0) {
                        subtotal = prices[type][size] * qty;
                        orderSummary.push(`${typeName} (${size.toUpperCase()}): ${qty}kg x â‚¹${prices[type][size]} = â‚¹${subtotal}`);
                    }

                    subtotalSpan.textContent = `â‚¹${subtotal}`;
                    itemTotal += subtotal;
                });

                document.getElementById(`${type}_total`).textContent = `â‚¹${itemTotal}`;
                grandTotal += itemTotal;
            });

            currentTotal = grandTotal;
            currentOrderSummary = orderSummary.join('\n');

            document.getElementById('grandTotal').textContent = `â‚¹${grandTotal}`;
            document.getElementById('checkoutBtn').textContent = `Pay with Razorpay (â‚¹${grandTotal})`;
            document.getElementById('checkoutBtn').disabled = grandTotal === 0;
            document.getElementById('orderSummaryInput').value = orderSummary.join(' | ') + ` | TOTAL: â‚¹${grandTotal}`;
        }

        function validateForm() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const address1 = document.getElementById('customerAddress1').value.trim();

            if (!name || !phone || !email || !address1) {
                alert('Please fill in all required fields (Name, Phone, Email, Delivery Address 1)');
                return false;
            }
            if (currentTotal === 0) {
                alert('Please add items to your order');
                return false;
            }
            return true;
        }

        function initiatePayment() {
            if (!validateForm()) return;

            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const address1 = document.getElementById('customerAddress1').value.trim();
            const address2 = document.getElementById('customerAddress2').value.trim();

            const options = {
                key: RAZORPAY_KEY,
                amount: currentTotal * 100, // Razorpay expects amount in paise
                currency: 'INR',
                name: 'VV Foods Papad',
                description: 'Bulk Appalam Order',
                image: 'https://vvfoodspapad.github.io/VVFoodsPapadlogo.png',
                prefill: {
                    name: name,
                    email: email,
                    contact: phone
                },
                theme: {
                    color: '#e8b86d'
                },
                handler: function(response) {
                    // Payment successful - send invoice email
                    sendInvoiceEmail(response.razorpay_payment_id, name, email, phone, address1, address2);
                },
                modal: {
                    ondismiss: function() {
                        isProcessingPayment = false;
                        console.log('Payment cancelled');
                    },
                    confirm_close: true,
                    escape: false
                }
            };

            isProcessingPayment = true;
            const rzp = new Razorpay(options);
            rzp.on('payment.failed', function(response) {
                isProcessingPayment = false;
                alert('Payment failed. Please try again. Error: ' + response.error.description);
            });
            rzp.open();
        }

        function sendInvoiceEmail(paymentId, name, email, phone, address1, address2) {
            // Create invoice details
            const invoiceData = {
                _subject: `âœ… PAID - New Order from ${name} (Payment ID: ${paymentId})`,
                _captcha: 'false',
                _template: 'table',
                'Payment ID': paymentId,
                'Payment Status': 'PAID âœ…',
                'Customer Name': name,
                'Customer Email': email,
                'Customer Phone': phone,
                'Delivery Address 1': address1,
                'Delivery Address 2': address2 || 'Not provided',
                'Order Details': currentOrderSummary,
                'Total Amount': `â‚¹${currentTotal}`,
                'Order Date': new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' })
            };

            // Send to FormSubmit
            fetch('https://formsubmit.co/ajax/veera17179@gmail.com', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify(invoiceData)
            })
            .then(response => response.json())
            .then(data => {
                isProcessingPayment = false;
                closeOrderModal();
                showSuccessMessage(paymentId);
            })
            .catch(error => {
                console.error('Email error:', error);
                isProcessingPayment = false;
                closeOrderModal();
                showSuccessMessage(paymentId);
            });
        }

        function showSuccessMessage(paymentId) {
            alert(`ðŸŽ‰ Payment Successful!\n\nPayment ID: ${paymentId}\nAmount: â‚¹${currentTotal}\n\nThank you for your order! An invoice has been sent to our team. We will contact you shortly to arrange delivery.`);
            // Reset form
            document.getElementById('orderForm').reset();
            ['plain', 'pepper', 'cumin'].forEach(type => {
                const container = document.getElementById(`${type}_rows`);
                const rows = container.querySelectorAll('.order-row');
                rows.forEach((row, index) => {
                    if (index > 0) row.remove();
                });
            });
            calculateTotal();
        }

        function openOrderModal() {
            const modal = document.getElementById('orderModal');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            // Trigger reflow for animation
            modal.offsetHeight;
            modal.classList.add('active');
        }

        function closeOrderModal() {
            const modal = document.getElementById('orderModal');
            modal.classList.add('closing');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
                modal.classList.remove('closing');
                document.body.style.overflow = 'auto';
            }, 300);
        }

        window.onclick = function(event) {
            const modal = document.getElementById('orderModal');
            if (event.target === modal && !modal.classList.contains('closing')) {
                closeOrderModal();
            }
        }

        // Prevent page reload during transaction
        let isProcessingPayment = false;
        window.addEventListener('beforeunload', function(e) {
            if (isProcessingPayment) {
                e.preventDefault();
                e.returnValue = 'Payment is in progress. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>

